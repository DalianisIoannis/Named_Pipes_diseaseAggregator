Ιωάννης Δαλιάνης
1115201700027

Το script δημιουργεί ονοματεπώνυμα συνδυάζοντας hardcoded ονόματα και επίθετα.
Πολλά αρχεία και συναρτήσεις έχουν γίνει copy-paste από την πρώτη εργασία του
μαθήματος.

Οι χώρες ισομοιράζονται στους workers με τη σειρά μία προς μία.

Με make γίνεται compile το πρόγραμμα, με make run εκτελείται η εντολή
./diseaseAggregator -w 5 -b 32 -i "./input_dir/", ενώ με make valgrind η εντολή
valgrind --track-origins=yes --trace-children=yes --leak-check=full ./diseaseAggregator -w 5 -b 32 -i "./input_dir/".
Το script μπορεί να εκτελεστεί μέσω του Makefile με την εντολή make script. Με make clean καθαρίζονται το εκτελέσιμο,
τα αντικειμενικά αρχεία και τα logFile αρχεία του καταλόγου logFiles.

Το bash script δημιουργεί εγγραφές με διαφορετικό ID η καθεμιά. Η μόνη περίπτωσηη
να δημιουργηθεί εγγραφή με ήδη υπάρχον ID είναι για εγγραφή EXIT. Ουσιαστικά μια
εγγραφή EXIT επίτηδες δημιουργείται με ήδη υπάρχον ID, έτσι ώστε να προσθέτουμε
την ημερομηνία της ως exitdate της υπάρχουσας ENTER εγγραφής. Δεν υπάρχει
περίπτωση να δημιουργηθούν διπλότυπες εγγραφές ασθενών, οπότε δεν ελέγχεται αυτό
το ενδεχόμενο. εκτυπώνονται ERROR αν μια exitdate δεν είναι έγκυρη.

Στη γραμμή 118 του main.c είναι η συνάρτηση που εκτυπώνει τα statistics
που στέλνουν οι worker στον πατέρα κατά την δημιουργία δομών δεδομένων
με τις εγγραφές ασθενών που παίρνουν από τα αρχεία των χωρών. Ο πατέρας
έχει κάποιες δομές που αποθηκεύουν τα pid των παιδιών του και τις χώρες που
αναλαμβάνει κάθε παιδί. Αυτό είναι χρήσιμο για τα querries για να μπορεί
ο πατέρας να στέλνει αιτήσεις στα κατάλληλα παιδιά με βάση τις χώρες που
αποθηκεύουν, αντί να στέλνει το ίδιο αίτημα σε όλα τα παιδιά και να του
απαντάει μόνο το ένα.

Ο πατέρας χρησιμοποιεί 2 pipes για να πετύχει επικοινωνία με κάθε παιδί του.
Το ένα χρησιμοποιείται για να διαβάζει ο πατέρας και να γράφει το παιδί, ενώ
το άλλο για να διαβάζει το παιδί και να γράφει ο πατέρας.

Οι workers χρησιμοποιούν μια δομή requestStruct για να μετράνε το πλήθος των αιτημάτων που
τους έγιναν από τον πατέρα. Ο πατέρας στέλνει σε κάθε παιδί τις χώρες που αναλαμβάνει μέσω
pipes.

Στο αρχείο pipes.c υλοποιούνται δύο συναρτήσεις το γράψιμο και το διάβασμα μέσω pipes. Οι
συναρτήσεις αυτές υλοποιούν read και write χρησιμοποιώντας ένα buffersize που δίνεται και
καθιστούν δυνατή τη λήψη και την παραλαβή μηνυμάτων ανεξαρτήτως του πόσο πιο μικρό ή πιο μεγάλο
από το buffersize είναι το μήνυμα που θέλουμε να στείλουμε.

Η συνάρτηση returnIforCountry χρησιμοποιείται για να βρίσκει ο πατέρας σε ποιο παιδί
υπάρχει μια συγκεκριμένη χώρα για να του στέλνει το querry. Ελέγχεται και η περίπτωση κατά την οποία
η χώρα που δίνεται δεν υπάρχει σε κανένα παιδί.

Όλα τα pipes στις περιπτώσεις που περιμένουν πολλαπλά διαβάσματα εκτελούν ατέρμονες for μέχρι η άλλη μεριά
να γράψει "OK" ή "WRONG".

Στη workerRun δίνονται hardcoded τα μεγέθη για τα hash tables των worker σύμφωνα με τις προδιαγραφές της
1ης εργασίας. Κάθε worker αποθηκεύει ένα hash table που κρατάει τις εγγραφές με κλειδί τη χώρα και ένα
που κρατάει τις εγγραφές με κλειδί την ασθένεια.

Το πρόγραμμα κάνει handle μόνο τα σήματα SIGINT, SIGQUIT και SIGURS1. Για το SIGURS1 εμφανίζει
μήνυμα ότι το δέχτηκε και το pid του παιδιού που το δέχτηκε και ανιχνεύει τον καινούριο φάκελο, τοποθετώντας
τον στη λίστα με τα ονόματα όλων των φακέλων του worker. Για τα άλλα δύο σήματα εκτυπώνει μήνυμα
ότι τα δέχτηκε, το pid του παιδιού που τα δέχτηκε και στη συνέχεια δημιουργεί στο φάκελο logFiles το
αρχείο log για το συγκεκριμένο παιδί.
